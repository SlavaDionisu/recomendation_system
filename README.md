# Рекомендательная система постов в социальной сети

## Описание

Этот сервис может для каждого пользователя по его ID в любой момент времени возвращать посты, которые ему покажут в его ленте соцсети.  
Данные о пользователях, постах и их взаимодействиях хранятся в соответствующих таблицах. Набор данных фиксирован, новых данных не появляется. Модель обучена на имеющихся данных и не обучается в процессе использования. Дополнительно сделаны рекомендации для новых пользователей.  
Обработка данных: выделены новые признаки у постов, такие, как рейтинг поста (соотношение лайков к просмотрам). Тексты постов векторизованы при промощи модели RoBERTa. Для уменьшения размерности полученных данных и ускорения обучения методом главных компонент определено количество компонент, объясняющих 95% дисперсии, PCA произведен на оптимальном количестве компонент.  
Работа сервиса: пользователю будут рекомендовать только посты, которые он еще не видел. Модель Catboost предсказывает вероятности того, что пользователь лайкнет тот или иной пост, далее посты ранжируются по вероятности лайка и возвращается необходимое количесво (по умолчанию 5).  
Технические ограничения: среднее время работы одного запроса не более 0,5 секунд, ограничения по памяти не больше, чем 4 гб RAM на запуск. 

## Общие требования
- Python 3.8.5
- Git
- pip (менеджер пакетов Python)

## Установка и запуск

1. Скопируйте репозиторий:
    ```bash
    git clone https://github.com/SlavaDionisu/recomendation_system.git
    cd recomendation_system
    ```
2. Создайте виртуальное окружение (рекомендуется):
    - Windows:
        ```bash
        python -m venv venv
        venv\Scripts\activate
        ```
    - macOS и Linux:
        ```bash
        python3 -m venv venv
        source venv/bin/activate
        ```
3. Установите необходимые зависимости:  
    - Установка библиотеки PyTorch
        * Если вы используете Windows, у вас есть видеокарта NVIDIA и вы хотите использовать её для ускорения вычислений, выполните следующие шаги:
            + Установите драйверы CUDA:  
            Убедитесь, что у вас установлены драйверы CUDA, совместимые с вашей видеокартой. Вы можете скачать их с [официального сайта NVIDIA](https://developer.nvidia.com/cuda-downloads).  
            Также вам понадобиится CUDA Toolkit, который соответствует версии драйверов - cледуйте инструкциям по установке на сайте NVIDIA.
            Если вы используете Windows, убедитесь, что у вас установлены компоненты C++ build tools из Visual Studio.
            + Установите PyTorch с поддержкой CUDA:  
                ```bash
                pip install torch --index-url https://download.pytorch.org/whl/cu121
                ```
        * Если у вас нет видеокарты NVIDIA или вы используете macOS или вы не хотите использовать CUDA, выполните следующие шаги:
            + Установите PyTorch без поддержки CUDA:  
                ```bash
                pip install torch==2.4.1
                ```
        * После установки PyTorch вы можете проверить, что он установлен правильно, выполнив следующий код на Python:
            ```bash
            import torch
            print(torch.__version__)
            print(torch.cuda.is_available())  # Должно вернуть True, если CUDA доступна
            ```
    - Установите остальные зависимости:
        ```bash
        pip install -r requirements.txt 
        ``` 
4. Запустите основной код для запуска рекомендательной системы:  
    ```bash
    python src/main.py
    ```
    Запуск может занять некоторое время, особенно, если вы не используете CUDA.
5. Как опробовать рекомендательную систему:
    - Вы можете использовать инструмент для тестирования API, такой как Postman или curl.
    - Или перейдите по адресу `http://127.0.0.1:8000/docs` для доступа к автоматически сгенерированной документации Swagger UI. Используйте интерфейс Swagger UI для отправки запросов к вашим эндпоинтам. Вы можете вводить параметры запроса и сразу видеть ответы.
    - Или откройте браузер и введите URL эндпоинта в следующем формате:
        ```bash
        http://127.0.0.1:8000/post/recommendations/?id={user_id}&time={time}&limit={limit}
        ```
        Вместо скобок {} подставьте id пользователя, для которого хотите получить рекомендации, время в формате ISO 8601 и количество постов (по умолчанию 5). Формат ISO 8601 включает в себя дату и время, разделенные символом `T`, и выглядит следующим образом: `YYYY-MM-DDTHH:MM:SS`
6. Остановка сервера:  
    Для остановки сервера нажмите `Ctrl+C` в терминале, где он был запущен.

## Структура проекта
recommendation_system/  
│  
├── data/                                      # папка для хранения данных  
│   ├── users.csv                              # пользователи соцсети  
│   ├── posts.csv                              # посты соцсети  
│   └── feeds.csv                              # история взаимодействия юзеров с постами  
│  
├── recommendation_system/  
│   ├── recommendation_system.py               # основной скрипт рекомендательной системы  
│   └── catboost_model                         # модель  
│  
├── src/                  
│   ├── main.py                                # входная точка запуска приложения  
│   └── schema.py                              # схема API  
│  
├── .gitignore                                 # файл для исключения отслеживания файлов  
├── README.md                                  # описание проекта  
└── requirements.txt                           # файл с зависимостями проекта  

## Структура таблиц
Таблица users. Cодержит информацию о всех пользователях соц.сети.

Колонки:
- age - возраст пользователя (в профиле)
- city - город пользователя (в профиле)
- country - страна пользователя (в профиле)
- exp_group - экспериментальная группа: некоторая зашифрованная категория
- gender - пол пользователя
- user_id - уникальный идентификатор пользователя
- os - операционная система устройства, с которого происходит пользование соц.сетью
- source - пришел ли пользователь в приложение с органического трафика или с рекламы

Таблица posts. Содержит информацию о постах и уникальный ID каждой единицы с соответствующим ей текстом и темой поста.

Колонки:
- id - уникальный идентификатор поста
- text - текстовое содержание поста
- topic - основная тематика

Таблица feeds. Содержит историю о просмотренных постах для каждого юзера в изучаемый период.

Колонки:
- timestamp - время, когда был произведен просмотр
- user_id - id пользователя, который совершил просмотр
- post_id - id просмотренного поста
- action - тип действия: просмотр или лайк
- target - 1 у просмотров, если почти сразу после просмотра был совершен лайк, иначе 0. У действий like пропущенное значение.